const defaultOptions={lineWidth:3,strokeStyle:"#000",linecap:"round"};export class ASP{constructor(t,e={lineWidth:defaultOptions.lineWidth,strokeStyle:defaultOptions.strokeStyle,linecap:defaultOptions.linecap}){this.canvas=t,this.options=e,this._mouseCoord={x:0,y:0},this.drawer=this.draw.bind(this),this.stoper=this.stop.bind(this),this.paths=[],this._ctx=t.getContext("2d"),this.setDefaults(),this.canvas.addEventListener("mousedown",this.start.bind(this))}setDefaults(){void 0===this.options.lineWidth&&(this.options.lineWidth=defaultOptions.lineWidth),void 0===this.options.strokeStyle&&(this.options.strokeStyle=defaultOptions.strokeStyle),void 0===this.options.linecap&&(this.options.linecap=defaultOptions.linecap)}initEvent(){this.canvas.addEventListener("mouseup",this.stoper),this.canvas.addEventListener("mouseleave",this.stoper),this.canvas.addEventListener("mousemove",this.drawer)}removeEvent(){this.canvas.removeEventListener("mouseup",this.stoper),this.canvas.removeEventListener("mouseleave",this.stoper),this.canvas.removeEventListener("mousemove",this.drawer)}getCanvas(){return this.canvas}clearCanvas(){this._ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.paths=[]}start(t){this.setMouseCoord(t),this.paths.push({pointPaths:"M"+this._mouseCoord.x+","+this._mouseCoord.y+"L"+this._mouseCoord.x+","+this._mouseCoord.y,start:new Date,end:new Date}),this.initEvent()}setMouseCoord(t){this._mouseCoord.x=t.clientX-this.canvas.offsetLeft,this._mouseCoord.y=t.clientY-this.canvas.offsetTop}stop(){this.paths[this.paths.length-1].end=new Date,this.removeEvent()}draw(t){this._ctx.beginPath(),this._ctx.lineWidth=this.options.lineWidth?this.options.lineWidth:defaultOptions.lineWidth,this._ctx.lineCap=this.options.linecap?this.options.linecap:defaultOptions.linecap,this._ctx.strokeStyle=this.options.strokeStyle?this.options.strokeStyle:defaultOptions.strokeStyle,this._ctx.moveTo(this._mouseCoord.x,this._mouseCoord.y),this.setMouseCoord(t),this._ctx.lineTo(this._mouseCoord.x,this._mouseCoord.y),this.paths[this.paths.length-1].pointPaths+=" "+this._mouseCoord.x+","+this._mouseCoord.y,this._ctx.stroke()}getSvg(t=!0){return this.generateSvg(this.canvas,this.options,this.paths,t)}exportData(){return{options:this.options,paths:this.paths}}importData(t){this.options=t.options,this.paths=t.paths,this.paths.forEach(((t,e)=>{"string"==typeof t.start&&(this.paths[e].start=new Date(t.start)),"string"==typeof t.end&&(this.paths[e].end=new Date(t.end))}))}generateSvg(t,e,s,i=!1){const o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttribute("width",t.width.toString()),o.setAttribute("height",t.height.toString());let n=0,a=0;return s.forEach(((t,s)=>{const h=document.createElementNS("http://www.w3.org/2000/svg","path");if(h.setAttribute("id",`p${s}`),h.setAttribute("d",t.pointPaths.toString()),h.setAttribute("stroke",e.strokeStyle?e.strokeStyle.toString():defaultOptions.strokeStyle.toString()),h.setAttribute("stroke-width",e.lineWidth?e.lineWidth.toString():defaultOptions.lineWidth.toString()),h.setAttribute("stroke-linecap",e.linecap?e.linecap.toString():defaultOptions.linecap.toString()),h.setAttribute("fill","none"),i){const e=parseInt(h.getTotalLength().toString()).toString();h.setAttribute("stroke-dasharray",e),h.setAttribute("stroke-offset",e),a=t.end.getTime()-t.start.getTime();const s=document.createElementNS(o.namespaceURI,"animate");s.setAttribute("attributeName","stroke-dashoffset"),s.setAttribute("begin",n+.1+"ms"),s.setAttribute("values",e+";0"),s.setAttribute("dur",a+"ms"),s.setAttribute("calcMode","freeze"),h.appendChild(s),n=a}o.appendChild(h)})),o}downloadSvg(t="download.svg",e=!0){const s=this.generateSvg(this.canvas,this.options,this.paths,e),i=(new XMLSerializer).serializeToString(s),o=new Blob([i],{type:"image/svg+xml"}),n=window.URL.createObjectURL(o),a=document.createElement("a");a.href=n,a.download=t,a.click()}}